(function(){Cowbell.Common.AYChip=function(b){var q=[0,0.004583,0.006821,0.009684,0.014114,0.020614,0.028239,0.045633,0.056376,0.08822,0.117568,0.149977,0.190123,0.229088,0.282717,0.333324],d={ABC:[0.25,0.5,0.75],ACB:[0.25,0.75,0.5],BAC:[0.5,0.25,0.75],BCA:[0.75,0.25,0.5],CAB:[0.5,0.75,0.25],CBA:[0.75,0.5,0.25]},p=b.frequency/b.sampleRate,m=0,k=8,g=0,l=0,f=8,a=0,B=0,e=8,c=0,u=0,x=16,v=0,s=1,D=0,E=0,F=0,G=0,H=0,I=0,y=256,t=0,w=16,z=!0,J=0,A=0,K=0,L=0,M=0,n=0;b=b.panning?b.panning:b.stereoMode?d[b.stereoMode.toUpperCase()]||
[0.5,0.5,0.5]:[0.5,0.5,0.5];for(var r=[],d=0;3>d;d++)r[d]=[Math.sqrt(1-b[d]),Math.sqrt(b[d])];var h=new Uint8Array(14);this.setRegister=function(c,a){h[c]=a;switch(c){case 0:case 1:k=8*((h[1]&15)<<8|h[0]);0===k&&(k=8);break;case 2:case 3:f=8*((h[3]&15)<<8|h[2]);0===f&&(f=8);break;case 4:case 5:e=8*((h[5]&15)<<8|h[4]);0===e&&(e=8);break;case 6:x=16*(a&31);0===x&&(x=16);break;case 7:D=a&1?255:0;E=a&2?255:0;F=a&4?255:0;G=a&8?255:0;H=a&16?255:0;I=a&32?255:0;break;case 11:case 12:y=16*(h[12]<<8|h[11]);
0===y&&(y=16);break;case 13:t=0,w=16,z=!0,A=0,K=a&1?15:0,J=a&2?15:0,L=a&4?15:0,M=a&8?15:0}};this.generate=function(b,d,C){C=d+C;var Q=b.getChannelData(0);for(b=b.getChannelData(1);d<C;d++){for(g-=p;0>g;)g+=k,m^=255;for(a-=p;0>a;)a+=f,l^=255;for(c-=p;0>c;)c+=e,B^=255;for(v-=p;0>v;)v+=x,s+1&2&&(u^=255),s&1&&(s^=147456),s>>=1;for(t-=p;0>t;)t+=y,w--,0>w&&(w=15,z=!1,A^=15),n=w^(A&&J),z||(n|=K),n^=L,z||(n&=M);var N=q[(h[8]&16?n:h[8]&15)&(m|D)&(u|G)],O=q[(h[9]&16?n:h[9]&15)&(l|E)&(u|H)],P=q[(h[10]&16?n:
h[10]&15)&(B|F)&(u|I)];Q[d]=r[0][0]*N+r[1][0]*O+r[2][0]*P;b[d]=r[0][1]*N+r[1][1]*O+r[2][1]*P}}};Cowbell.Common.AYGenerator=function(b,q,d){var p,m,k=this,g,l,f=0,a=0;this.seekable=!0;this.seek=function(b){b*=q.sampleRate;a=Math.floor(b/m);var e=g[a];if(e)for(var c=0;14>c;c++)l.setRegister(c,e[c]);f=m-b%m;a++};this.reset=function(){this.seek(0)};this.generateAudio=function(b){for(var e=0;e<b.length;){var c=b.length-e;if(c<m){l.generate(b,e,c);e+=c;f-=c;break}else c=Math.floor(f),l.generate(b,e,c),
e+=c,f-=c;if(a>=g.length)break;for(var c=g[a],d=0;13>d;d++)l.setRegister(d,c[d]);c[14]&&l.setRegister(13,c[13]);a++;f+=m}return e};this.load=function(a){this.channelCount=2;var e=new XMLHttpRequest;e.addEventListener("error",function(a){console.log("XHR error",a)});e.addEventListener("load",function(c){data=e.response;c=new Uint8Array(data);d(c,function(c){g=c.ayRegisterLog;l=new Cowbell.Common.AYChip({frequency:c.ayFrequency||1773400,panning:c.panning,stereoMode:c.stereoMode,sampleRate:q.sampleRate});
p=1/(c.commandFrequency||50);m=p*q.sampleRate;k.duration=g.length*p;a()})});e.open("GET",b,!0);e.responseType="arraybuffer";e.send()}}})();(function(){function b(b,d){return new Cowbell.Common.AYGenerator(b,d,function(b,d){if("PSG\u001a"!==String.fromCharCode.apply(null,b.subarray(0,4)))throw"Not a PSG file";for(var k=16,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,!1],l=[],f;k<b.length;){for(g[14]=!1;;){var a=b[k];k++;if(253==a)return l;if(255==a){f=1;break}else if(254==a){f=4*b[k];k++;break}else if(14>a)g[a]=b[k],k++,13==a&&(g[14]=!0);else throw"Unexpected command: "+a;}for(a=0;a<f;a++)l.push(g.slice())}d({ayRegisterLog:l})})}Cowbell.Player.PSG=
function(){return new Cowbell.Common.WebAudioPlayer(b)}})();
