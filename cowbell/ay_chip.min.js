(function(){Cowbell.Common.AYChip=function(a){var c,b=Math.sqrt,d=a.frequency,e=a.sampleRate,f=a.mode,g=[0,0,.004583,.004583,.006821,.006821,.009684,.009684,.014114,.014114,.020614,.020614,.028239,.028239,.045633,.045633,.056376,.056376,.08822,.08822,.117568,.117568,.149977,.149977,.190123,.190123,.229088,.229088,.282717,.282717,.333324,.333324],h=d/e,j=0,k=8,l=0,m=0,n=8,o=0,p=0,q=8,r=0,s=0,t=16,u=0,v=1,w=0,x=0,y=0,z=0,A=0,B=0,C=256,D=0,E=31,F=!0,G=0,H=0,I=0,J=0,K=0,L=0;c=a.panning?a.panning:a.stereoMode?{ABC:[.25,.5,.75],ACB:[.25,.75,.5],BAC:[.5,.25,.75],BCA:[.75,.25,.5],CAB:[.5,.75,.25],CBA:[.75,.5,.25]}[a.stereoMode.toUpperCase()]||[.5,.5,.5]:[.5,.5,.5],"YM"==f&&(g=[0,369/196605,438/196605,521/196605,619/196605,735/196605,874/196605,1039/196605,1234/196605,1467/196605,1744/196605,2072/196605,2463/196605,2927/196605,3479/196605,4135/196605,4914/196605,5841/196605,6942/196605,8250/196605,9806/196605,11654/196605,13851/196605,16462/196605,19565/196605,23253/196605,27636/196605,32845/196605,39037/196605,46395/196605,55141/196605,65535/196605]);for(var M=[],N=0;3>N;N++)M[N]=[b(1-c[N]),b(c[N])];var O=new Uint8Array(14);this.setRegister=function(a,b){O[a]=b;0===a||1===a?(k=8*((15&O[1])<<8|O[0]),0===k&&(k=8)):2===a||3===a?(n=8*((15&O[3])<<8|O[2]),0===n&&(n=8)):4===a||5===a?(q=8*((15&O[5])<<8|O[4]),0===q&&(q=8)):6===a?(t=16*(31&b),0===t&&(t=16)):7===a?(w=1&b?255:0,x=2&b?255:0,y=4&b?255:0,z=8&b?255:0,A=16&b?255:0,B=32&b?255:0):11===a||12===a?(C=16*(O[12]<<8|O[11]),0===C&&(C=16)):13===a?(D=0,E=32,F=!0,H=0,I=1&b?31:0,G=2&b?31:0,J=4&b?31:0,K=8&b?31:0):void 0},this.generate=function(a,b,c){for(var f=a.getChannelData(0),i=a.getChannelData(1),N=b;N<b+c;N++){for(l-=h;0>l;)l+=k,j^=255;for(o-=h;0>o;)o+=n,m^=255;for(r-=h;0>r;)r+=q,p^=255;for(u-=h;0>u;)u+=t,2&v+1&&(s^=255),1&v&&(v^=147456),v>>=1;for(D-=2*(d/e);0>D;)D+=C,E--,0>E&&(E=31,F=!1,H^=31),L=E^(H&&G),F||(L|=I),L^=J,F||(L&=K);var P=g[(16&O[8]?L:(15&O[8])<<1)&(j|w)&(s|z)],Q=g[(16&O[9]?L:(15&O[9])<<1)&(m|x)&(s|A)],R=g[(16&O[10]?L:(15&O[10])<<1)&(p|y)&(s|B)];f[N]=M[0][0]*P+M[1][0]*Q+M[2][0]*R,i[N]=M[0][1]*P+M[1][1]*Q+M[2][1]*R}}},Cowbell.Common.AYGenerator=function(a,b,c){var e,f,g,h,d=Math.floor,i=this,j=0,k=0;this.seekable=!0,this.seek=function(a){var c=a*b.sampleRate;k=d(c/f);var e=g[k];if(e)for(var l=0;14>l;l++)h.setRegister(l,e[l]);j=f-c%f,k++},this.reset=function(){this.seek(0)},this.generateAudio=function(a){for(var b=0;b<a.length;){var c=a.length-b;if(c<f){h.generate(a,b,c),b+=c,j-=c;break}else{var e=d(j);h.generate(a,b,e),b+=e,j-=e}if(k>=g.length)return b;for(var l=g[k],m=0;13>m;m++)h.setRegister(m,l[m]);l[14]&&h.setRegister(13,l[13]),k++,j+=f}return b},this.load=function(d){this.channelCount=2;var j=new XMLHttpRequest;j.addEventListener("error",function(a){console.log("XHR error",a)}),j.addEventListener("load",function(){data=j.response;var a=new Uint8Array(data);c(a,function(a){g=a.ayRegisterLog,h=new Cowbell.Common.AYChip({frequency:a.ayFrequency||1773400,panning:a.panning,stereoMode:a.stereoMode,sampleRate:b.sampleRate,mode:a.ayMode||"AY"}),e=1/(a.commandFrequency||50),f=e*b.sampleRate,i.duration=g.length*e,d()})}),j.open("GET",a,!0),j.responseType="arraybuffer",j.send()}}})(),function(){function a(a,b,c,d){return c||(c={}),d||(d={}),new Cowbell.Common.AYGenerator(a,b,function(a,b){var e=String.fromCharCode,f=e.apply(null,a.subarray(0,4));if("PSG\x1A"!==f)throw"Not a PSG file";for(var g,h=16,j=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,!1],k=[];h<a.length;){for(j[14]=!1;;){var l=a[h];if(h++,253==l){h=a.length;break}else if(255==l){g=1;break}else if(254==l){g=4*a[h],h++;break}else if(14>l)j[l]=a[h],h++,13==l&&(j[14]=!0);else throw"Unexpected command: "+l}for(var m=0;m<g;m++)k.push(j.slice())}b({ayRegisterLog:k,ayFrequency:d.ayFrequency||c.ayFrequency,commandFrequency:d.commandFrequency||c.commandFrequency,stereoMode:d.stereoMode||c.stereoMode,panning:d.panning||c.panning,ayMode:d.ayMode||c.ayMode})})}Cowbell.Player.PSG=function(b){return new Cowbell.Common.WebAudioPlayer(a,b)}}();