(function(){function n(f,n,d,m){function p(a){if(!d.pathToLibOpenMPT)throw"pathToLibOpenMPT not specified";if(window.libopenmpt&&window.libopenmpt._openmpt_module_create_from_memory)a();else{var e=document.getElementsByTagName("head")[0],b=document.createElement("script");b.src=d.pathToLibOpenMPT;window.libopenmpt={memoryInitializerPrefixURL:d.pathToLibOpenMPT.replace(/[^/]+$/,"")};var c=!1;b.onload=b.onreadystatechange=function(){if(!c&&(!this.readyState||"loaded"==this.readyState||"complete"==this.readyState))c=
!0,a(),e.removeChild(b)};e.appendChild(b)}}var e,g,h,q=this;d||(d={});m||(m={});this.cleanup=function(){e&&libopenmpt._openmpt_module_destroy(e);g&&libopenmpt._free(g);h&&libopenmpt._free(h)};this.load=function(a){var d=this;p(function(){d.channelCount=2;var b=new XMLHttpRequest;b.addEventListener("error",function(a){console.log("XHR error",a)});b.addEventListener("load",function(c){data=b.response;c=new Int8Array(data);var d=libopenmpt._malloc(c.byteLength);libopenmpt.HEAPU8.set(c,d);e=libopenmpt._openmpt_module_create_from_memory(d,
c.byteLength,0,0,0);g=libopenmpt._malloc(16384);h=libopenmpt._malloc(16384);q.duration=libopenmpt._openmpt_module_get_duration_seconds(e);a()});b.open("GET",f,!0);b.responseType="arraybuffer";b.send()})};this.generateAudio=function(a){var d=a.getChannelData(0),b=a.getChannelData(1);a=a.length;for(var c=0;0<a;){for(var f=Math.min(a,4096),k=libopenmpt._openmpt_module_read_float_stereo(e,n.sampleRate,f,g,h),m=libopenmpt.HEAPF32.subarray(g/4,g/4+k),p=libopenmpt.HEAPF32.subarray(h/4,h/4+k),l=0;l<k;++l)d[c+
l]=m[l],b[c+l]=p[l];a-=k;c+=k;if(k<f)break}return c};this.seekable=!0;this.seek=function(a){libopenmpt._openmpt_module_set_position_seconds(e,a)};this.reset=function(){this.seek(0)}}Cowbell.Player.OpenMPT=function(f){return new Cowbell.Common.WebAudioPlayer(n,f)}})();
