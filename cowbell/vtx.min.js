(function(){var a=Math.min,b=function(a){this.buffer=a,this.offset=0,this.subOffset=7};b.SeekAbsolute=0,b.SeekRelative=1,b.prototype.readBits=function(a){for(var b,c=[1,2,4,8,16,32,64,128],d=this.buffer[this.offset],e=0,f=0;f<a;f++)if(b=(d&c[this.subOffset])>>this.subOffset,e<<=1,e|=b,this.subOffset--,0>this.subOffset){if(this.offset+1>=this.buffer.length)return-1;d=this.buffer[++this.offset],this.subOffset=7}return e},b.prototype.readUInt8=function(){return this.offset+1>=this.buffer.length?-1:this.buffer[this.offset++]},b.prototype.readUInt16=function(){if(this.offset+2>=this.buffer.length)return-1;var a=255&this.buffer[this.offset]|65280&this.buffer[this.offset+1]<<8;return this.offset+=2,a},b.prototype.readUInt32=function(){if(this.offset+4>=this.buffer.length)return-1;var a=255&this.buffer[this.offset]|65280&this.buffer[this.offset+1]<<8|16711680&this.buffer[this.offset+2]<<16|4278190080&this.buffer[this.offset+3]<<24;return this.offset+=4,a},b.prototype.readString=function(a){if(this.offset+a>=this.buffer.length)return-1;for(var b="",c=0;c<a;c++)b+=String.fromCharCode(this.buffer[this.offset++]);return b},b.prototype.readLength=function(){var a=this.readBits(3);if(-1==a)return-1;if(7==a)for(;0!=this.readBits(1);)a++;return a},b.prototype.seek=function(a,c){c===b.SeekAbsolute?(this.offset=a,this.subOffset=7):c===b.SeekRelative?(this.offset+=a,this.subOffset=7):void 0},b.prototype.getPosition=function(){return this.offset};var c=function(a){this.offset=0,this.size=a,this.data=new Uint8Array(a)};c.prototype.write=function(a){this.data[this.offset++]=a};var d=function(){};d.LEAF=32768,d.prototype.setConstant=function(a){this.tree[0]=a|d.LEAF},d.prototype.expand=function(){for(var a=this.allocated;this.nextEntry<a;)this.tree[this.nextEntry]=this.allocated,this.allocated+=2,this.nextEntry++},d.prototype.addCodesWithLength=function(a,b){for(var c=!0,e=0;e<a.length;e++)if(a[e]==b){var f=this.nextEntry++;this.tree[f]=e|d.LEAF}else a[e]>b&&(c=!1);return c},d.prototype.build=function(a,b){this.tree=[];for(var c=0;c<b;c++)this.tree[c]=d.LEAF;this.nextEntry=0,this.allocated=1;var e=0;do this.expand(),e++;while(!this.addCodesWithLength(a,e))},d.prototype.readCode=function(a){for(var b=this.tree[0];0==(b&d.LEAF);){var c=a.readBits(1);b=this.tree[b+c]}return b&~d.LEAF};var e=function(a){this.data=[],this.size=a,this.offset=0};e.prototype.add=function(a){this.data[this.offset]=a,this.offset=(this.offset+1)%this.size},e.prototype.get=function(a,b){for(var c,d=this.offset+this.size-a-1,e=[],f=0;f<b;f++)c=this.data[(d+f)%this.size],e.push(c),this.add(c);return e};var f=function(a,b){if(this.reader=a,this.offsetTree=new d,this.codeTree=new d,"lh4"==b)this.ringBuffer=new e(8192);else if("lh5"==b)this.ringBuffer=new e(16384);else throw"mode must be either lh4 or lh5"};f.prototype.readTempTable=function(){var b=this.reader,c=a(b.readBits(5),19);if(0>=c){var d=b.readBits(5);return void this.offsetTree.setConstant(d)}for(var e,f=[],g=0;g<c;g++)if(e=b.readLength(),f.push(e),2==g)for(var h=b.readBits(2);0<h--;)f.push(0),g++;this.offsetTree.build(f,38)},f.prototype.readCodeTable=function(){var b=this.reader,c=a(b.readBits(9),510);if(0>=c){var d=b.readBits(9);return void this.codeTree.setConstant(d)}for(var e,f=[],g=0;g<c;)if(e=this.offsetTree.readCode(b),2>=e){var h=1;for(1==e?h=b.readBits(4)+3:2==e&&(h=b.readBits(9)+20);0<=--h;)f.push(0),g++}else f.push(e-2),g++;this.codeTree.build(f,1020)},f.prototype.readOffsetTable=function(){var b=this.reader,c=a(b.readBits(4),14);if(0>=c){var d=b.readBits(4);return void this.offsetTree.setConstant(d)}for(var e,f=[],g=0;g<c;g++)e=b.readLength(),f[g]=e;this.offsetTree.build(f,38)},f.prototype.extract=function(a,d,e){function f(){if(h.extractBlock(g)){if(e&&e(g.offset,g.size),g.offset>=g.size)return;setTimeout(f,1)}}this.reader.seek(a,b.SeekAbsolute);var g=new c(d),h=this;return setTimeout(f,1),g.data},f.prototype.extractBlock=function(a){var b=this.reader,c=b.readBits(16);if(0>=c||b.offset>=b.size)return!1;this.readTempTable(),this.readCodeTable(),this.readOffsetTable();for(var d,e=0;e<c;e++)if(d=this.codeTree.readCode(b),256>d)this.ringBuffer.add(d),a.write(d);else{var f=this.offsetTree.readCode(b),g=f;if(2<=f){var g=b.readBits(f-1);g+=1<<f-1}var h=d-256+3,k=this.ringBuffer.get(g,h);for(var l in k)a.write(k[l])}return!0},Cowbell.Common.LhaArrayReader=b,Cowbell.Common.LhaReader=f})(),function(){var a=String.fromCharCode;function b(b,c){return new Cowbell.Common.AYGenerator(b,c,function(b,c){var d=a.apply(null,b.subarray(0,2));if("ay"!==d&&"ym"!==d)throw"Not a VTX file";for(var e=d.toUpperCase(),f={1:"abc",2:"acb",3:"bac",4:"bca",5:"cab",6:"cba"},g=7&b[2],h=f[g]||"mono",j=b[8]<<24|b[7]<<16|b[6]<<8|b[5],k=b[9],l=b[11]<<8|b[10],m=b[15]<<24|b[14]<<16|b[13]<<8|b[12],n=16,o=16;0!==b[n];)n++;a.apply(null,b.subarray(o,n));n++;for(var p=n;0!==b[n];)n++;a.apply(null,b.subarray(p,n));n++;for(var q=n;0!==b[n];)n++;a.apply(null,b.subarray(q,n));n++;for(var r=n;0!==b[n];)n++;a.apply(null,b.subarray(r,n));n++;for(var s=n;0!==b[n];)n++;a.apply(null,b.subarray(s,n));n++;var t=new Cowbell.Common.LhaReader(new Cowbell.Common.LhaArrayReader(b),"lh5"),u=t.extract(n,m,function(a,b){if(!(a<b)){for(var d,f=m/14,g=[],l=0,n=0;n<f;n++){d=[];for(var o,p=0;14>p;p++)o=u[p*f+n],13>p?d[p]=o:255==o?(d[13]=l,d[14]=!1):(d[13]=o,l=o,d[14]=!0);g[n]=d}c({ayRegisterLog:g,ayFrequency:j,commandFrequency:k,stereoMode:h,ayMode:e})}})})}Cowbell.Player.VTX=function(){return new Cowbell.Common.WebAudioPlayer(b)}}();